<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainHeading">üå§Ô∏è Weather in <span id="headingCity">Bangalore</span></h1>
            <p>Get real-time weather information for any city</p>
        </div>

        <div class="search-section">
            <div class="search-box">
                <input type="text" id="cityInput" placeholder="Enter city name..." autocomplete="off">
                <button id="searchBtn" onclick="searchWeather()">Search</button>
            </div>
            <div id="errorMessage" class="error-message"></div>
        </div>

        <div class="weather-container" id="weatherContainer" style="display: none;">
            <div class="weather-main">
                <div class="city-info">
                    <h2 id="cityName"></h2>
                    <p id="weatherDescription"></p>
                </div>
                <div class="temperature-section">
                    <div class="temperature">
                        <span id="temperature"></span>
                        <span class="celsius">¬∞C</span>
                    </div>
                    <img id="weatherIcon" src="" alt="Weather icon">
                </div>
            </div>

            <div class="weather-details">
                <div class="detail-card">
                    <p class="detail-label">Wind Speed</p>
                    <div class="detail-content">
                        <div class="detail-icon">üí®</div>
                        <p class="detail-value"><span id="windSpeed"></span> m/s</p>
                    </div>
                </div>

                <div class="detail-card">
                    <p class="detail-label">Humidity</p>
                    <div class="detail-content">
                        <div class="detail-icon">üíß</div>
                        <p class="detail-value"><span id="humidity"></span>%</p>
                    </div>
                </div>

                <div class="detail-card">
                    <p class="detail-label">Pressure</p>
                    <div class="detail-content">
                        <div class="detail-icon">üîΩ</div>
                        <p class="detail-value"><span id="pressure"></span> hPa</p>
                    </div>
                </div>

                <div class="detail-card">
                    <p class="detail-label">Cloudiness</p>
                    <div class="detail-content">
                        <div class="detail-icon">‚òÅÔ∏è</div>
                        <p class="detail-value"><span id="cloudiness"></span>%</p>
                    </div>
                </div>

                <div class="detail-card">
                    <p class="detail-label">Feels Like</p>
                    <div class="detail-content">
                        <div class="detail-icon">üå°Ô∏è</div>
                        <p class="detail-value"><span id="feelsLike"></span>¬∞C</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loadingSpinner" style="display: none;">
            <div class="spinner"></div>
            <p>Loading weather data...</p>
        </div>
    </div>

    <script>
        const cityInput = document.getElementById('cityInput');
        const searchBtn = document.getElementById('searchBtn');
        const weatherContainer = document.getElementById('weatherContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('errorMessage');

        searchBtn.addEventListener('click', searchWeather);
        cityInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchWeather();
            }
        });

        function searchWeather() {
            const city = cityInput.value.trim();
            if (!city) {
                errorMessage.textContent = 'Please enter a city name';
                errorMessage.style.display = 'block';
                return;
            }

            errorMessage.style.display = 'none';
            loadingSpinner.style.display = 'flex';
            weatherContainer.style.display = 'none';

            fetch('/get_weather', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ city: city })
            })
            .then(response => response.json())
            .then(data => {
                loadingSpinner.style.display = 'none';

                if (data.success) {
                    displayWeather(data);
                } else {
                    errorMessage.textContent = data.error || 'Error fetching weather data';
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                loadingSpinner.style.display = 'none';
                errorMessage.textContent = 'Network error. Please try again.';
                errorMessage.style.display = 'block';
                console.error('Error:', error);
            });
        }

        function displayWeather(data) {
            document.getElementById('cityName').textContent = `${data.city}, ${data.country}`;
            // Update main heading to reflect the city dynamically
            const headingCity = document.getElementById('headingCity');
            if (headingCity) headingCity.textContent = data.city;
            document.getElementById('temperature').textContent = Math.round(data.temperature);
            document.getElementById('weatherDescription').textContent = data.description.charAt(0).toUpperCase() + data.description.slice(1);
            document.getElementById('windSpeed').textContent = data.wind_speed.toFixed(1);
            document.getElementById('humidity').textContent = data.humidity;
            document.getElementById('pressure').textContent = data.pressure;
            document.getElementById('cloudiness').textContent = data.cloudiness;
            document.getElementById('feelsLike').textContent = Math.round(data.feels_like);
            
            const iconUrl = `https://openweathermap.org/img/wn/${data.icon}@4x.png`;
            document.getElementById('weatherIcon').src = iconUrl;

            weatherContainer.style.display = 'block';
        }

        // Load default city on page load
        window.addEventListener('load', function() {
            cityInput.value = 'Bangalore';
            searchWeather();
        });
    </script>
</body>
</html>
